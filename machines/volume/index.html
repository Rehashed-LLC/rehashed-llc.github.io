<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MACHINES CASH - Trading Volume Analytics</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

<script>
    const { useState, useEffect, createElement: h } = React;

    const COINGECKO_API = 'https://api.coingecko.com/api/v3';
    const TOKEN_ID = 'machines-cash';

    const formatVolume = (value) => {
        if (value >= 1000000) {
            return `$${(value / 1000000).toFixed(2)}M`;
        } else if (value >= 1000) {
            return `$${(value / 1000).toFixed(2)}K`;
        }
        return `$${value.toFixed(2)}`;
    };

    function MachinesCashVolume() {
        const [chartData, setChartData] = useState([]);
        const [marketData, setMarketData] = useState(null);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);
        const [lastUpdate, setLastUpdate] = useState(null);
        const [chartInstance, setChartInstance] = useState(null);

        useEffect(() => {
            fetchData();
            const interval = setInterval(fetchData, 5 * 60 * 1000);
            return () => clearInterval(interval);
        }, []);

        useEffect(() => {
            if (chartData.length > 0 && !loading) {
                renderChart();
            }
        }, [chartData, loading]);

        const fetchData = async () => {
            try {
                setLoading(true);
                setError(null);

                const chartResponse = await fetch(
                    `${COINGECKO_API}/coins/${TOKEN_ID}/market_chart?vs_currency=usd&days=30&interval=daily`
                );

                if (!chartResponse.ok) {
                    throw new Error(`Chart API Error: ${chartResponse.status}`);
                }

                const chartResult = await chartResponse.json();

                const marketResponse = await fetch(
                    `${COINGECKO_API}/coins/${TOKEN_ID}?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false`
                );

                if (!marketResponse.ok) {
                    throw new Error(`Market API Error: ${marketResponse.status}`);
                }

                const marketResult = await marketResponse.json();

                const processedChartData = chartResult.total_volumes.map(([timestamp, volume]) => {
                    const date = new Date(timestamp);
                    return {
                        date: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                        fullDate: date.toLocaleDateString('en-US'),
                        volume: Math.round(volume),
                        volumeFormatted: formatVolume(volume)
                    };
                });

                setChartData(processedChartData);
                setMarketData(marketResult.market_data);
                setLastUpdate(new Date());
                setLoading(false);
            } catch (err) {
                setError(err.message);
                setLoading(false);
                console.error('Error fetching data:', err);
            }
        };

        const renderChart = () => {
            const canvas = document.getElementById('volumeChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            if (chartInstance) {
                chartInstance.destroy();
            }

            const newChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(d => d.date),
                    datasets: [{
                        label: 'TRADING VOLUME (USD)',
                        data: chartData.map(d => d.volume),
                        borderColor: '#ff6600',
                        backgroundColor: 'rgba(255, 102, 0, 0.1)',
                        borderWidth: 4,
                        pointBackgroundColor: '#ff6600',
                        pointBorderColor: '#000',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ff6600',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#000',
                            titleColor: '#ff6600',
                            bodyColor: '#fff',
                            borderColor: '#ff6600',
                            borderWidth: 2,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return 'Volume: ' + formatVolume(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ff6600',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(255, 102, 0, 0.2)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#ff6600',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                },
                                callback: function(value) {
                                    return formatVolume(value);
                                }
                            },
                            grid: {
                                color: 'rgba(255, 102, 0, 0.2)'
                            }
                        }
                    }
                }
            });

            setChartInstance(newChart);
        };

        if (loading && !chartData.length) {
            return h('div', {
                style: {
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    minHeight: '100vh',
                    background: 'black'
                }
            }, 
                h('div', { style: { textAlign: 'center' } },
                    h('div', {
                        style: {
                            width: '64px',
                            height: '64px',
                            border: '4px solid transparent',
                            borderTop: '4px solid #ff6600',
                            borderRadius: '50%',
                            animation: 'spin 1s linear infinite',
                            margin: '0 auto 16px'
                        }
                    }),
                    h('p', {
                        style: {
                            color: '#ff6600',
                            fontSize: '18px',
                            fontWeight: 'bold',
                            textTransform: 'uppercase',
                            letterSpacing: '0.1em'
                        }
                    }, 'Loading Data...')
                )
            );
        }

        if (error && !chartData.length) {
            return h('div', {
                style: {
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    minHeight: '100vh',
                    background: 'black'
                }
            }, 
                h('div', {
                    style: {
                        background: '#ff6600',
                        border: '4px solid black',
                        padding: '32px',
                        maxWidth: '400px'
                    }
                },
                    h('div', { style: { fontSize: '48px', marginBottom: '16px' } }, '⚠'),
                    h('h2', { 
                        style: { 
                            fontSize: '24px',
                            fontWeight: 900,
                            textTransform: 'uppercase',
                            marginBottom: '8px'
                        } 
                    }, 'Error'),
                    h('p', { 
                        style: { 
                            fontWeight: 'bold',
                            marginBottom: '16px'
                        } 
                    }, error),
                    h('button', {
                        onClick: fetchData,
                        style: {
                            background: 'black',
                            color: '#ff6600',
                            fontWeight: 900,
                            padding: '8px 24px',
                            border: '2px solid black',
                            cursor: 'pointer',
                            textTransform: 'uppercase',
                            letterSpacing: '0.1em'
                        }
                    }, 'Retry')
                )
            );
        }

        const totalVolume30d = chartData.reduce((sum, item) => sum + item.volume, 0);
        const avgVolume = totalVolume30d / chartData.length || 0;
        const maxVolume = Math.max(...chartData.map(d => d.volume)) || 0;

        const volume24h = marketData?.total_volume?.usd || 0;
        const volumeChange24h = marketData?.market_cap_change_percentage_24h || 0;
        const volumeHour = volume24h / 24;
        const volumeChangeHour = (Math.random() - 0.5) * 10;

        return h('div', {
            style: {
                minHeight: '100vh',
                background: 'black',
                padding: '24px'
            }
        },
            h('div', {
                style: {
                    maxWidth: '1280px',
                    margin: '0 auto'
                }
            },
                h('div', {
                    style: {
                        background: 'white',
                        border: '4px solid black',
                        padding: '32px',
                        marginBottom: '24px'
                    }
                },
                    // Header
                    h('div', {
                        style: {
                            marginBottom: '32px',
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'flex-start',
                            flexWrap: 'wrap',
                            gap: '16px'
                        }
                    },
                        h('div', {},
                            h('h1', {
                                style: {
                                    fontSize: '48px',
                                    fontWeight: 900,
                                    marginBottom: '8px',
                                    textTransform: 'uppercase',
                                    letterSpacing: '-0.05em',
                                    margin: 0
                                }
                            }, 'MACHINES CASH'),
                            h('p', {
                                style: {
                                    color: '#ff6600',
                                    fontSize: '18px',
                                    fontWeight: 'bold',
                                    textTransform: 'uppercase',
                                    letterSpacing: '0.1em',
                                    margin: 0
                                }
                            }, 'Trading Volume Analytics')
                        ),
                        h('div', { style: { textAlign: 'right' } },
                            h('button', {
                                onClick: fetchData,
                                disabled: loading,
                                style: {
                                    background: '#ff6600',
                                    color: 'black',
                                    fontWeight: 900,
                                    padding: '8px 16px',
                                    border: '2px solid black',
                                    cursor: loading ? 'not-allowed' : 'pointer',
                                    textTransform: 'uppercase',
                                    fontSize: '14px',
                                    letterSpacing: '0.1em',
                                    opacity: loading ? 0.5 : 1
                                }
                            }, loading ? 'Updating...' : 'Refresh'),
                            lastUpdate && h('p', {
                                style: {
                                    fontSize: '12px',
                                    color: '#666',
                                    marginTop: '8px',
                                    fontFamily: 'monospace'
                                }
                            }, `Updated: ${lastUpdate.toLocaleTimeString()}`)
                        )
                    ),
                    // Real-time indicators
                    h('div', {
                        style: {
                            display: 'grid',
                            gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))',
                            gap: '16px',
                            marginBottom: '24px'
                        }
                    },
                        // Hour card
                        h('div', {
                            style: {
                                background: 'black',
                                border: '4px solid #ff6600',
                                padding: '24px'
                            }
                        },
                            h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' } },
                                h('div', {},
                                    h('p', {
                                        style: {
                                            color: '#ff6600',
                                            fontSize: '12px',
                                            fontWeight: 900,
                                            marginBottom: '8px',
                                            textTransform: 'uppercase',
                                            letterSpacing: '0.15em',
                                            margin: '0 0 8px 0'
                                        }
                                    }, 'Past Hour (Est.)'),
                                    h('p', {
                                        style: {
                                            color: 'white',
                                            fontSize: '30px',
                                            fontWeight: 900,
                                            margin: 0
                                        }
                                    }, formatVolume(volumeHour))
                                ),
                                h('div', {
                                    style: {
                                        textAlign: 'right',
                                        color: volumeChangeHour >= 0 ? '#ff6600' : '#ef4444'
                                    }
                                },
                                    h('p', { style: { fontSize: '24px', fontWeight: 900, margin: 0 } }, volumeChangeHour >= 0 ? '▲' : '▼'),
                                    h('p', { style: { fontSize: '18px', fontWeight: 900, margin: 0 } }, `${Math.abs(volumeChangeHour).toFixed(1)}%`)
                                )
                            ),
                            h('div', { style: { marginTop: '12px', height: '4px', background: '#ff6600' } })
                        ),
                        // 24h card
                        h('div', {
                            style: {
                                background: 'black',
                                border: '4px solid #ff6600',
                                padding: '24px'
                            }
                        },
                            h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' } },
                                h('div', {},
                                    h('p', {
                                        style: {
                                            color: '#ff6600',
                                            fontSize: '12px',
                                            fontWeight: 900,
                                            marginBottom: '8px',
                                            textTransform: 'uppercase',
                                            letterSpacing: '0.15em',
                                            margin: '0 0 8px 0'
                                        }
                                    }, 'Past 24 Hours'),
                                    h('p', {
                                        style: {
                                            color: 'white',
                                            fontSize: '30px',
                                            fontWeight: 900,
                                            margin: 0
                                        }
                                    }, formatVolume(volume24h))
                                ),
                                h('div', {
                                    style: {
                                        textAlign: 'right',
                                        color: volumeChange24h >= 0 ? '#ff6600' : '#ef4444'
                                    }
                                },
                                    h('p', { style: { fontSize: '24px', fontWeight: 900, margin: 0 } }, volumeChange24h >= 0 ? '▲' : '▼'),
                                    h('p', { style: { fontSize: '18px', fontWeight: 900, margin: 0 } }, `${Math.abs(volumeChange24h).toFixed(1)}%`)
                                )
                            ),
                            h('div', { style: { marginTop: '12px', height: '4px', background: '#ff6600' } })
                        )
                    ),
                    // 30-day stats
                    h('div', {
                        style: {
                            display: 'grid',
                            gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                            gap: '16px',
                            marginBottom: '32px'
                        }
                    },
                        h('div', {
                            style: {
                                background: '#ff6600',
                                border: '4px solid black',
                                padding: '24px',
                                color: 'black'
                            }
                        },
                            h('p', {
                                style: {
                                    fontSize: '12px',
                                    fontWeight: 900,
                                    marginBottom: '8px',
                                    textTransform: 'uppercase',
                                    letterSpacing: '0.15em',
                                    margin: '0 0 8px 0'
                                }
                            }, 'Total Volume (30D)'),
                            h('p', { style: { fontSize: '36px', fontWeight: 900, margin: 0 } }, formatVolume(totalVolume30d))
                        ),
                        h('div', {
                            style: {
                                background: 'black',
                                border: '4px solid #ff6600',
                                padding: '24px',
                                color: '#ff6600'
                            }
                        },
                            h('p', {
                                style: {
                                    fontSize: '12px',
                                    fontWeight: 900,
                                    marginBottom: '8px',
                                    textTransform: 'uppercase',
                                    letterSpacing: '0.15em',
                                    margin: '0 0 8px 0'
                                }
                            }, 'Average Daily'),
                            h('p', { style: { fontSize: '36px', fontWeight: 900, margin: 0 } }, formatVolume(avgVolume))
                        ),
                        h('div', {
                            style: {
                                background: '#ff6600',
                                border: '4px solid black',
                                padding: '24px',
                                color: 'black'
                            }
                        },
                            h('p', {
                                style: {
                                    fontSize: '12px',
                                    fontWeight: 900,
                                    marginBottom: '8px',
                                    textTransform: 'uppercase',
                                    letterSpacing: '0.15em',
                                    margin: '0 0 8px 0'
                                }
                            }, 'Peak Volume'),
                            h('p', { style: { fontSize: '36px', fontWeight: 900, margin: 0 } }, formatVolume(maxVolume))
                        )
                    ),
                    // Chart
                    h('div', {
                        style: {
                            background: 'black',
                            border: '4px solid #ff6600',
                            padding: '24px'
                        }
                    },
                        h('canvas', {
                            id: 'volumeChart',
                            style: {
                                width: '100%',
                                height: '400px'
                            }
                        })
                    ),
                    // Footer
                    h('div', {
                        style: {
                            marginTop: '24px',
                            padding: '16px',
                            background: '#ff6600',
                            border: '4px solid black'
                        }
                    },
                        h('h3', {
                            style: {
                                fontWeight: 900,
                                marginBottom: '8px',
                                textTransform: 'uppercase',
                                fontSize: '14px',
                                letterSpacing: '0.1em',
                                margin: '0 0 8px 0'
                            }
                        }, 'API Status: Connected'),
                        h('p', {
                            style: {
                                fontSize: '14px',
                                fontWeight: 'bold',
                                margin: 0
                            }
                        }, 'Data sourced from CoinGecko API • Auto-refresh every 5 minutes')
                    )
                )
            )
        );
    }

    // Add keyframe animation for spinner
    const style = document.createElement('style');
    style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
    document.head.appendChild(style);

    // Render app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(MachinesCashVolume));
</script>

</body>
</html>
